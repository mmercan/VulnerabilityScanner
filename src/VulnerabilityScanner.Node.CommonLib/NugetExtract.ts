import fs = require('fs-extra');
import path = require('path');

export default class NugetExtract {


    constructor(private slnLocation: string) {
        if (slnLocation.toLocaleLowerCase().endsWith("sln")) {
            console.info("working with solution " + slnLocation);
            let projects = this.extractProjectFromSln();
        }
        else if (slnLocation.toLocaleLowerCase().endsWith("csproj")) {
            console.info("working with project " + slnLocation);
        }

    }

    public extractProjectFromSln(): string[] {
        let projects: string[] = [];
        let slnfolder = path.dirname(this.slnLocation)
        let filecontent = fs.readFileSync(this.slnLocation, 'utf8');

        let i = 0;
        filecontent.split(/\r?\n/).forEach((line) => {
            if (!line.startsWith("Project")) {
                return;
            }
            let regex = new RegExp("(.*) = \"(.*?)\", \"(.*?.(cs|vb)proj)\"");
            let match = regex.exec(line);
            if (match && match.length > 0) {
                i++;
                //const fullprjlocation = tl.findMatch(slnfolder, match[3])[0];
                const fullprjlocation = path.join(slnfolder, match[3])
                projects.push(fullprjlocation);
                console.log(i + " : " + fullprjlocation);
            }
        });
        return projects;
    }

}