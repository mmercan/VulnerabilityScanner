#!/usr/bin/env node
import { NugetExtract, QueryVulnerabilities, ReportToConsole } from 'vulnerability-scanner';

import { Command } from 'commander';
const program = new Command();

program.name('string-util').description('CLI to tool to list OSS Vulnerability Indexes').version('0.8.0');

program
  .command('sln')
  .description('Search Vulnerabilities on projects listed in sln file credit to https://ossindex.sonatype.org/')
  .argument('<string>', 'sln file location')
  .option('--first', 'display just the first substring')
  .option('-s, --separator <char>', 'separator character', ',')
  .action(async (slnfile: any, options: any) => {
    const tt = new NugetExtract(slnfile);
    const query = new QueryVulnerabilities();
    await query.QueryAllPackages(tt.projects);

    ReportToConsole(tt.projects);
  });

program.parse();

// const  { program } =  require('commander');

// program
//   .option('--first')
//   .option('-s, --separator <char>');

// program.parse();

// const options = program.opts();
// const limit = options.first ? 1 : undefined;
// console.log(program.args[0].split(options.separator, limit));

// NugetExtract
// QueryVulnerabilities
// //ReportToConsole()

// console.log("started....");

// const { program } = require('commander')

// program
//     .command('sln')
//     .description('List all the TODO tasks')
//     .action(list)

//     async function  list(file:string)
//     {
//         console.log("sln triggered...");
//         const tt = new NugetExtract('C:\\Workspace\\github\\Sentinel\\sentinel\\Sentinel.Web.sln');
//         const query = new QueryVulnerabilities();
//         await query.QueryAllPackages(tt.projects);

//         ReportToConsole(tt.projects);
//     }

// module.exports = list
